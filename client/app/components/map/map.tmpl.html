<div layout="column">
    <div class="md-toolbar-tools md-whiteframe-2dp" id="mapToolbar" ng-if="$ctrl.isHeaderVisible()">
        <div layout="column" layout-align="center center">
            <div>{{$ctrl.season.season}} {{$ctrl.season.year}}</div>
        </div>
        <span flex></span>
        <div ng-if="!$ctrl.readonly">
            <md-button class="md-icon-button" aria-label="Change action" hide-gt-xs>
                <md-icon md-svg-icon="join"></md-icon>
                <md-tooltip>Change action</md-tooltip>
            </md-button>
            <md-button ng-if="$ctrl.canMove" ng-click="$ctrl.changeAction('hold')" class="md-icon-button" aria-label="Hold" hide-xs>
                <md-icon md-svg-icon="join" ng-class="{'active': $ctrl.currentAction === 'hold' }"></md-icon>
                <md-tooltip>Hold</md-tooltip>
            </md-button>
            <md-button ng-if="$ctrl.canMove || $ctrl.canRetreat" ng-click="$ctrl.changeAction('move')" class="md-icon-button" aria-label="Move" hide-xs>
                <md-icon md-svg-icon="join" ng-class="{'active': $ctrl.currentAction === 'move' }"></md-icon>
                <md-tooltip>Move</md-tooltip>
            </md-button>
            <md-button ng-if="$ctrl.canMove" ng-click="$ctrl.changeAction('support')" class="md-icon-button" aria-label="Support" hide-xs>
                <md-icon md-svg-icon="join" ng-class="{'active': $ctrl.currentAction === 'support' }"></md-icon>
                <md-tooltip>Support</md-tooltip>
            </md-button>
            <md-button ng-if="$ctrl.canMove" ng-click="$ctrl.changeAction('convoy')" class="md-icon-button" aria-label="Convoy" hide-xs>
                <md-icon md-svg-icon="join" ng-class="{'active': $ctrl.currentAction === 'convoy' }"></md-icon>
                <md-tooltip>Convoy</md-tooltip>
            </md-button>
            <md-button ng-if="$ctrl.canBuild" ng-click="$ctrl.changeAction('build')" class="md-icon-button" aria-label="Build" hide-xs>
                <md-icon md-svg-icon="join" ng-class="{'active': $ctrl.currentAction === 'build' }"></md-icon>
                <md-tooltip>Build</md-tooltip>
            </md-button>
            <md-button ng-if="$ctrl.canBuild" ng-click="$ctrl.changeAction('disband')" class="md-icon-button" aria-label="Disband" hide-xs>
                <md-icon md-svg-icon="join" ng-class="{'active': $ctrl.currentAction === 'disband' }"></md-icon>
                <md-tooltip>Disband</md-tooltip>
            </md-button>
        </div>
    </div>

    <div class="md-whiteframe-2dp">
        <div class="mapContainer" ng-class="{'notStarted': !$ctrl.season}" ng-style="{'background-image':'url({{$ctrl.imagePath}})'}">
            <svg width="100%" ng-attr-view_box="{{$ctrl.viewBox}}">
                <defs>
                    <marker id="move" viewBox="0 -5 10 10" markerWidth="6" markerHeight="6" orient="auto" class="ok">
                        <path d="M0,-5L10,0L0,5"></path>
                    </marker>
                    <marker id="support" viewBox="-6 -6 12 12" markerWidth="6" markerHeight="6" orient="auto" class="ok">
                        <path d="M 0,0m -5,0a 5,5 0 1,0 10,0 a 5,5 0 1,0 -10,0"></path>
                    </marker>

                    <!-- Supply centre template -->
                    <path d="m 15.64,213.212 117.92,105.865 -33.174,154.959 c -1.035,4.834 0.876,9.824 4.876,12.729 3.999,2.906 9.335,3.181 13.613,0.704 l 137.124,-79.434 137.124,79.434 c 1.944,1.126 4.107,1.684 6.265,1.684 2.588,0 5.167,-0.802 7.348,-2.387 4,-2.906 5.911,-7.896 4.876,-12.729 L 378.44,319.077 496.359,213.212 c 3.679,-3.302 5.065,-8.462 3.538,-13.164 -1.528,-4.702 -5.683,-8.061 -10.6,-8.571 L 331.671,175.143 267.425,30.279 c -2.004,-4.519 -6.483,-7.432 -11.427,-7.432 -4.944,0 -9.423,2.914 -11.427,7.433 L 180.329,175.143 22.702,191.477 c -4.917,0.51 -9.072,3.869 -10.6,8.571 -1.528,4.702 -0.141,9.862 3.538,13.164 z" id="sc"></path>
                </defs>

                <g class="scLayer">
                    <use xmlns:xlink="http://www.w3.org/1999/xlink" ng-repeat="region in $ctrl.season.regions | filter: { sc: '!!' }" xlink:href="" ng-href="{{$ctrl.scPath}}" ng-attr-transform="{{$ctrl.getSCTransform(region.r)}}" class="sc">
                </g>
                <!-- TODO: Don't hard-code transform attribute -->
                <g class="mouseLayer" transform="translate(8,4)" ng-if="!$ctrl.readonly">
                    <path ng-repeat="(r, d) in $ctrl.paths"
                        id="{{r}}"
                        ng-attr-d="{{d}}"
                        ng-click="$ctrl.inputCommand(r)"
                        ng-class="{'clicked': $ctrl.commandData.indexOf('{{r.toUpperCase()}}') >= 0}"></path>
                </g>
            </svg>
        </div>
    </div>
</div>
